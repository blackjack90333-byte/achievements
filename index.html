<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—Ä–µ–∫–µ—Ä –î–æ—Å—Ç–∏–∂–µ–Ω–∏–π</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        input[type="text"] {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            min-width: 200px;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-add {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-connect {
            background: #4CAF50;
            color: white;
        }

        .btn-connect:hover {
            background: #45a049;
        }

        .btn-connect.active {
            background: #ff9800;
            animation: pulse 1s infinite;
        }

        .btn-export {
            background: #2196F3;
            color: white;
        }

        .btn-export:hover {
            background: #0b7dda;
        }

        .btn-import {
            background: #9C27B0;
            color: white;
        }

        .btn-import:hover {
            background: #7B1FA2;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .workspace-wrapper {
            position: relative;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: auto;
            max-height: 80vh;
        }

        .workspace {
            position: relative;
            background: white;
            min-height: 600px;
            width: 100%;
            transition: all 0.3s;
        }

        .expand-controls {
            position: fixed;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1000;
        }

        .expand-btn {
            background: white;
            border: 3px solid #667eea;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        .expand-btn:hover {
            background: #667eea;
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .expand-btn-label {
            background: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            color: #667eea;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }

        .canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        #arrowCanvas {
            width: 100%;
            height: 100%;
        }

        .achievement {
            position: absolute;
            padding: 15px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            cursor: move;
            user-select: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
            min-width: 150px;
            max-width: 300px;
            word-wrap: break-word;
        }

        .achievement:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .achievement.completed {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            text-decoration: line-through;
            opacity: 0.8;
        }

        .achievement-text {
            margin-bottom: 10px;
            font-size: 16px;
            line-height: 1.4;
        }

        .achievement-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .achievement-buttons button {
            padding: 6px 12px;
            font-size: 14px;
            flex: 1;
            min-width: 70px;
        }

        .btn-complete {
            background: #4CAF50;
            color: white;
        }

        .btn-complete:hover {
            background: #45a049;
        }

        .btn-delete {
            background: #f44336;
            color: white;
        }

        .btn-delete:hover {
            background: #da190b;
        }

        .info {
            background: #fff3cd;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            color: #856404;
            font-size: 14px;
        }

        .settings-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 2px solid #e0e0e0;
        }

        .settings-panel h3 {
            margin: 0 0 10px 0;
            color: #667eea;
            font-size: 16px;
        }

        .settings-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .settings-row label {
            min-width: 120px;
            font-weight: 600;
            color: #333;
        }

        .settings-row input {
            flex: 1;
            min-width: 200px;
        }

        .btn-sync {
            background: #4CAF50;
            color: white;
        }

        .btn-sync:hover {
            background: #45a049;
        }

        .btn-sync:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .status-indicator.connected {
            background: #4CAF50;
        }

        .status-indicator.disconnected {
            background: #f44336;
        }

        .arrow {
            stroke: #667eea;
            stroke-width: 3;
            fill: none;
            marker-end: url(#arrowhead);
        }

        .arrow.from-completed {
            stroke: #4CAF50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ –ú–æ–∏ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h1>
        
        <div class="controls">
            <div class="input-group">
                <input type="text" id="achievementInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è...">
                <button class="btn-add" onclick="addAchievement()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
                <button class="btn-connect" id="connectBtn" onclick="toggleConnectMode()">üîó –°–æ–µ–¥–∏–Ω–∏—Ç—å</button>
                <button class="btn-export" onclick="exportToCSV()">üíæ –≠–∫—Å–ø–æ—Ä—Ç CSV</button>
                <button class="btn-import" onclick="document.getElementById('csvFileInput').click()">üìÇ –ò–º–ø–æ—Ä—Ç CSV</button>
                <button class="btn-import" onclick="loadFromSheets()">üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ Sheets</button>
                <input type="file" id="csvFileInput" accept=".csv" style="display: none;" onchange="importFromCSV(event)">
            </div>
            <div class="info" id="infoText">
                –î–æ–±–∞–≤—å—Ç–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∏—Ö –º—ã—à–∫–æ–π. –ù–∞–∂–º–∏—Ç–µ "–°–æ–µ–¥–∏–Ω–∏—Ç—å", –≤—ã–±–µ—Ä–∏—Ç–µ –¥–≤–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–∏.
            </div>
            
            <div class="settings-panel">
                <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Google Sheets API</h3>
                <div class="settings-row">
                    <label>Client ID:</label>
                    <input type="text" id="clientId" placeholder="–í–∞—à OAuth 2.0 Client ID">
                </div>
                <div class="settings-row">
                    <label>API –∫–ª—é—á:</label>
                    <input type="text" id="apiKey" placeholder="–í–∞—à Google API –∫–ª—é—á (–¥–ª—è —á—Ç–µ–Ω–∏—è)">
                </div>
                <div class="settings-row">
                    <label>ID —Ç–∞–±–ª–∏—Ü—ã:</label>
                    <input type="text" id="spreadsheetId" placeholder="ID –∏–∑ URL —Ç–∞–±–ª–∏—Ü—ã">
                </div>
                <div class="settings-row">
                    <button class="btn-sync" onclick="saveSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    <button class="btn-sync" id="authBtn" onclick="authorizeGoogle()" disabled>üîê –í–æ–π—Ç–∏ –≤ Google</button>
                    <button class="btn-sync" id="syncBtn" onclick="syncWithSheets()" disabled>üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</button>
                    <span id="connectionStatus"></span>
                </div>
                <div style="font-size: 12px; color: #666; margin-top: 10px;">
                    <a href="#" onclick="toggleInstructions(); return false;" style="color: #667eea;">üìñ –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å Client ID, API –∫–ª—é—á –∏ ID —Ç–∞–±–ª–∏—Ü—ã?</a>
                </div>
                <div id="instructions" style="display: none; margin-top: 10px; padding: 10px; background: white; border-radius: 8px; font-size: 13px;">
                    <strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ OAuth 2.0:</strong><br><br>
                    
                    <strong>1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤ Google Cloud Console:</strong><br>
                    ‚Ä¢ –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ <a href="https://console.cloud.google.com" target="_blank">console.cloud.google.com</a><br>
                    ‚Ä¢ –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Achievement Tracker")<br><br>
                    
                    <strong>2. –í–∫–ª—é—á–µ–Ω–∏–µ Google Sheets API:</strong><br>
                    ‚Ä¢ –í –º–µ–Ω—é ‚Üí "API –∏ —Å–µ—Ä–≤–∏—Å—ã" ‚Üí "–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞"<br>
                    ‚Ä¢ –ù–∞–π–¥–∏—Ç–µ "Google Sheets API" –∏ –Ω–∞–∂–º–∏—Ç–µ "–í–∫–ª—é—á–∏—Ç—å"<br><br>
                    
                    <strong>3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç–∫—Ä–∞–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞ –¥–æ—Å—Ç—É–ø–∞ OAuth:</strong><br>
                    ‚Ä¢ "API –∏ —Å–µ—Ä–≤–∏—Å—ã" ‚Üí "–≠–∫—Ä–∞–Ω –∑–∞–ø—Ä–æ—Å–∞ –¥–æ—Å—Ç—É–ø–∞ OAuth"<br>
                    ‚Ä¢ –¢–∏–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "–í–Ω–µ—à–Ω–∏–µ" ‚Üí –°–æ–∑–¥–∞—Ç—å<br>
                    ‚Ä¢ –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–æ–ª—å–∫–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, email)<br>
                    ‚Ä¢ –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ<br><br>
                    
                    <strong>4. –°–æ–∑–¥–∞–Ω–∏–µ OAuth 2.0 Client ID:</strong><br>
                    ‚Ä¢ "–£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ" ‚Üí "–°–æ–∑–¥–∞—Ç—å —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ" ‚Üí "–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞ OAuth"<br>
                    ‚Ä¢ –¢–∏–ø: "–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"<br>
                    ‚Ä¢ –ù–∞–∑–≤–∞–Ω–∏–µ: –ª—é–±–æ–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Web client")<br>
                    ‚Ä¢ <strong>–í–ê–ñ–ù–û!</strong> –í "–†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ JavaScript" –¥–æ–±–∞–≤—å—Ç–µ:<br>
                    <div style="background: #f0f0f0; padding: 8px; margin: 5px 0; border-radius: 4px; font-family: monospace;">
                    <strong>–ï—Å–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ (—Ñ–∞–π–ª HTML):</strong><br>
                    ‚Ä¢ –û—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª–µ –ø—É—Å—Ç—ã–º –ò–õ–ò –¥–æ–±–∞–≤—å—Ç–µ: https://claude.site<br><br>
                    <strong>–ï—Å–ª–∏ –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ:</strong><br>
                    ‚Ä¢ –í–∞—à —Ç–æ—á–Ω—ã–π URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: https://mysite.com)
                    </div>
                    ‚Ä¢ –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ URI –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º–∏ –¥–ª—è GIS<br>
                    ‚Ä¢ –°–æ–∑–¥–∞—Ç—å ‚Üí –°–∫–æ–ø–∏—Ä—É–π—Ç–µ "Client ID"<br><br>
                    
                    <strong>5. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã:</strong><br>
                    ‚Ä¢ –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é Google —Ç–∞–±–ª–∏—Ü—É<br>
                    ‚Ä¢ –í URL –Ω–∞–π–¥–∏—Ç–µ ID: docs.google.com/spreadsheets/d/<strong>[–í–ê–®_ID]</strong>/edit<br><br>
                    
                    <strong>6. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:</strong><br>
                    ‚Ä¢ –í—Å—Ç–∞–≤—å—Ç–µ Client ID –∏ ID —Ç–∞–±–ª–∏—Ü—ã –≤—ã—à–µ<br>
                    ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"<br>
                    ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏ –≤ Google" –∏ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø<br><br>
                    
                    <strong>‚ö†Ô∏è –ï—Å–ª–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–∞ 400:</strong><br>
                    ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ "–†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö" —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL<br>
                    ‚Ä¢ –î–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª–µ –ø—É—Å—Ç—ã–º<br>
                    ‚Ä¢ –ü–æ–¥–æ–∂–¥–∏—Ç–µ 5 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ OAuth
                </div>
            </div>
        </div>

        <div class="workspace-wrapper">
            <div class="workspace" id="workspace">
                <div class="canvas-container">
                    <svg id="arrowCanvas">
                        <defs>
                            <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                <polygon points="0 0, 10 3, 0 6" fill="#667eea" />
                            </marker>
                            <marker id="arrowhead-completed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                <polygon points="0 0, 10 3, 0 6" fill="#4CAF50" />
                            </marker>
                        </defs>
                    </svg>
                </div>
            </div>
        </div>

        <div class="expand-controls">
            <div>
                <button class="expand-btn" onclick="expandWidth()" title="–†–∞—Å—à–∏—Ä–∏—Ç—å –≤ —à–∏—Ä–∏–Ω—É">‚ÜîÔ∏è</button>
                <div class="expand-btn-label">–®–∏—Ä–∏–Ω–∞</div>
            </div>
            <div>
                <button class="expand-btn" onclick="expandHeight()" title="–†–∞—Å—à–∏—Ä–∏—Ç—å –≤ –≤—ã—Å–æ—Ç—É">‚ÜïÔ∏è</button>
                <div class="expand-btn-label">–í—ã—Å–æ—Ç–∞</div>
            </div>
            <div>
                <button class="expand-btn" onclick="resetSize()" title="–°–±—Ä–æ—Å–∏—Ç—å —Ä–∞–∑–º–µ—Ä">üîÑ</button>
                <div class="expand-btn-label">–°–±—Ä–æ—Å</div>
            </div>
        </div>
    </div>

    <script>
        let achievements = [];
        let connections = [];
        let connectMode = false;
        let firstSelected = null;
        let draggedElement = null;
        let offsetX = 0;
        let offsetY = 0;
        let workspaceWidth = 0;
        let workspaceHeight = 600;
        
        // Google Sheets API settings
        let clientId = '';
        let apiKey = '';
        let spreadsheetId = '';
        let isConnected = false;
        let accessToken = '';
        
        // Google API –∑–∞–≥—Ä—É–∑–∫–∞
        function loadGoogleAPI() {
            const script = document.createElement('script');
            script.src = 'https://accounts.google.com/gsi/client';
            script.async = true;
            script.defer = true;
            document.head.appendChild(script);
        }

        loadGoogleAPI();

        function toggleInstructions() {
            const instructions = document.getElementById('instructions');
            instructions.style.display = instructions.style.display === 'none' ? 'block' : 'none';
        }

        function saveSettings() {
            clientId = document.getElementById('clientId').value.trim();
            apiKey = document.getElementById('apiKey').value.trim();
            spreadsheetId = document.getElementById('spreadsheetId').value.trim();
            
            if (!clientId || !spreadsheetId) {
                alert('‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ Client ID –∏ ID —Ç–∞–±–ª–∏—Ü—ã!');
                return;
            }
            
            document.getElementById('authBtn').disabled = false;
            updateConnectionStatus(false, '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã. –ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏ –≤ Google"');
            alert('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! –¢–µ–ø–µ—Ä—å –Ω–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏ –≤ Google" –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.');
        }

        function authorizeGoogle() {
            if (!clientId) {
                alert('‚ùå –°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏!');
                return;
            }

            try {
                const client = google.accounts.oauth2.initTokenClient({
                    client_id: clientId,
                    scope: 'https://www.googleapis.com/auth/spreadsheets',
                    callback: async (response) => {
                        if (response.error) {
                            alert('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ' + response.error);
                            console.error('OAuth error:', response);
                            return;
                        }
                        
                        if (response.access_token) {
                            accessToken = response.access_token;
                            isConnected = true;
                            updateConnectionStatus(true, '–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ Google');
                            document.getElementById('syncBtn').disabled = false;
                            
                            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                            document.getElementById('infoText').textContent = 'üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Google Sheets...';
                            
                            try {
                                await loadFromSheetsAuto();
                            } catch (error) {
                                console.error('Auto-load error:', error);
                                // –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞ –∏–ª–∏ –æ—à–∏–±–∫–∞ - –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
                                document.getElementById('infoText').textContent = '–î–æ–±–∞–≤—å—Ç–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∏—Ö –º—ã—à–∫–æ–π. –ù–∞–∂–º–∏—Ç–µ "–°–æ–µ–¥–∏–Ω–∏—Ç—å", –≤—ã–±–µ—Ä–∏—Ç–µ –¥–≤–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–∏.';
                            }
                        }
                    },
                    error_callback: (error) => {
                        alert('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ' + JSON.stringify(error));
                        console.error('OAuth error:', error);
                    }
                });
                
                client.requestAccessToken();
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + error.message + '\n\n–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:\n1. Client ID –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π\n2. –í—ã –¥–æ–±–∞–≤–∏–ª–∏ —Ç–µ–∫—É—â–∏–π URL –≤ OAuth –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö\n3. –¢–µ–∫—É—â–∏–π URL: ' + window.location.origin);
                console.error('Authorization error:', error);
            }
        }

        async function loadFromSheetsAuto() {
            try {
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/A1:E1000`,
                    {
                        headers: {
                            'Authorization': `Bearer ${accessToken}`
                        }
                    }
                );

                if (response.ok) {
                    const data = await response.json();
                    const values = data.values || [];
                    
                    if (values.length <= 1) {
                        // –¢–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞ –∏–ª–∏ —Ç–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏
                        document.getElementById('infoText').textContent = '‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –Ω–∞–∂–º–∏—Ç–µ "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è" –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.';
                        return;
                    }
                    
                    let newAchievements = [];
                    let newConnections = [];
                    let readingConnections = false;
                    
                    for (let i = 1; i < values.length; i++) {
                        const row = values[i];
                        
                        if (!row || row.length === 0) continue;
                        
                        if (row[0] === '–°–í–Ø–ó–ò') {
                            readingConnections = false;
                            continue;
                        }
                        
                        if (row[0] === '–û—Ç ID') {
                            readingConnections = true;
                            continue;
                        }
                        
                        if (readingConnections) {
                            if (row[0] && row[1]) {
                                newConnections.push({
                                    from: parseInt(row[0]),
                                    to: parseInt(row[1])
                                });
                            }
                        } else {
                            if (row[0] && row[1]) {
                                newAchievements.push({
                                    id: parseInt(row[0]),
                                    text: row[1],
                                    x: parseFloat(row[2] || 100),
                                    y: parseFloat(row[3] || 100),
                                    completed: row[4]?.toLowerCase() === 'true'
                                });
                            }
                        }
                    }
                    
                    if (newAchievements.length > 0) {
                        achievements = newAchievements;
                        connections = newConnections;
                        renderAchievements();
                        document.getElementById('infoText').textContent = `‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${newAchievements.length} –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∏ ${newConnections.length} —Å–≤—è–∑–µ–π –∏–∑ Google Sheets!`;
                        setTimeout(() => {
                            document.getElementById('infoText').textContent = '–î–æ–±–∞–≤—å—Ç–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∏—Ö –º—ã—à–∫–æ–π. –ù–∞–∂–º–∏—Ç–µ "–°–æ–µ–¥–∏–Ω–∏—Ç—å", –≤—ã–±–µ—Ä–∏—Ç–µ –¥–≤–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–∏.';
                        }, 5000);
                    } else {
                        document.getElementById('infoText').textContent = '‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–∞–±–ª–∏—Ü–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.';
                    }
                } else {
                    document.getElementById('infoText').textContent = '‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é.';
                }
            } catch (error) {
                console.error('Auto-load error:', error);
                document.getElementById('infoText').textContent = '‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é.';
            }
        }

        function updateConnectionStatus(connected, message) {
            const status = document.getElementById('connectionStatus');
            status.innerHTML = `<span class="status-indicator ${connected ? 'connected' : 'disconnected'}"></span>${message}`;
        }

        async function syncWithSheets() {
            if (!isConnected || !accessToken) {
                alert('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ Google!');
                return;
            }

            try {
                // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
                const values = [
                    ['ID', '–¢–µ–∫—Å—Ç', '–ü–æ–∑–∏—Ü–∏—è X', '–ü–æ–∑–∏—Ü–∏—è Y', '–í—ã–ø–æ–ª–Ω–µ–Ω–æ']
                ];
                
                achievements.forEach(ach => {
                    values.push([
                        ach.id.toString(),
                        ach.text,
                        ach.x.toString(),
                        ach.y.toString(),
                        ach.completed.toString()
                    ]);
                });
                
                values.push(['', '', '', '', '']);
                values.push(['–°–í–Ø–ó–ò', '', '', '', '']);
                values.push(['–û—Ç ID', '–ö ID', '', '', '']);
                
                connections.forEach(conn => {
                    values.push([
                        conn.from.toString(),
                        conn.to.toString(),
                        '', '', ''
                    ]);
                });

                // –û—á–∏—Å—Ç–∫–∞ –ª–∏—Å—Ç–∞
                await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/A1:E1000:clear`,
                    {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${accessToken}`,
                            'Content-Type': 'application/json',
                        }
                    }
                );

                // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/A1:E${values.length}?valueInputOption=RAW`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${accessToken}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            values: values
                        })
                    }
                );

                if (response.ok) {
                    document.getElementById('infoText').textContent = `‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${achievements.length} –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∏ ${connections.length} —Å–≤—è–∑–µ–π –≤ Google Sheets.`;
                    setTimeout(() => {
                        document.getElementById('infoText').textContent = '–î–æ–±–∞–≤—å—Ç–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∏—Ö –º—ã—à–∫–æ–π. –ù–∞–∂–º–∏—Ç–µ "–°–æ–µ–¥–∏–Ω–∏—Ç—å", –≤—ã–±–µ—Ä–∏—Ç–µ –¥–≤–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–∏.';
                    }, 5000);
                } else {
                    const error = await response.json();
                    alert('‚ùå –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: ' + (error.error?.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: ' + error.message);
            }
        }

        async function loadFromSheets() {
            if (!isConnected || !accessToken) {
                alert('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ Google!');
                return;
            }

            try {
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/A1:E1000`,
                    {
                        headers: {
                            'Authorization': `Bearer ${accessToken}`
                        }
                    }
                );

                if (response.ok) {
                    const data = await response.json();
                    const values = data.values || [];
                    
                    let newAchievements = [];
                    let newConnections = [];
                    let readingConnections = false;
                    
                    for (let i = 1; i < values.length; i++) {
                        const row = values[i];
                        
                        if (!row || row.length === 0) continue;
                        
                        if (row[0] === '–°–í–Ø–ó–ò') {
                            readingConnections = false;
                            continue;
                        }
                        
                        if (row[0] === '–û—Ç ID') {
                            readingConnections = true;
                            continue;
                        }
                        
                        if (readingConnections) {
                            if (row[0] && row[1]) {
                                newConnections.push({
                                    from: parseInt(row[0]),
                                    to: parseInt(row[1])
                                });
                            }
                        } else {
                            if (row[0] && row[1]) {
                                newAchievements.push({
                                    id: parseInt(row[0]),
                                    text: row[1],
                                    x: parseFloat(row[2] || 0),
                                    y: parseFloat(row[3] || 0),
                                    completed: row[4]?.toLowerCase() === 'true'
                                });
                            }
                        }
                    }
                    
                    if (newAchievements.length > 0) {
                        if (confirm(`–ù–∞–π–¥–µ–Ω–æ ${newAchievements.length} –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –≤ Google Sheets. –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Ö?`)) {
                            achievements = newAchievements;
                            connections = newConnections;
                            renderAchievements();
                            document.getElementById('infoText').textContent = '‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ Google Sheets!';
                            setTimeout(() => {
                                document.getElementById('infoText').textContent = '–î–æ–±–∞–≤—å—Ç–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∏—Ö –º—ã—à–∫–æ–π. –ù–∞–∂–º–∏—Ç–µ "–°–æ–µ–¥–∏–Ω–∏—Ç—å", –≤—ã–±–µ—Ä–∏—Ç–µ –¥–≤–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–∏.';
                            }, 5000);
                        }
                    } else {
                        alert('üìã –¢–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞ –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.');
                    }
                } else {
                    const error = await response.json();
                    alert('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + (error.error?.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message);
            }
        }

        function expandWidth() {
            workspaceWidth += 500;
            updateWorkspaceSize();
        }

        function expandHeight() {
            workspaceHeight += 400;
            updateWorkspaceSize();
        }

        function resetSize() {
            workspaceWidth = 0;
            workspaceHeight = 600;
            updateWorkspaceSize();
        }

        function updateWorkspaceSize() {
            const workspace = document.getElementById('workspace');
            if (workspaceWidth > 0) {
                workspace.style.width = workspaceWidth + 'px';
            } else {
                workspace.style.width = '100%';
            }
            workspace.style.minHeight = workspaceHeight + 'px';
            
            setTimeout(() => {
                const svg = document.getElementById('arrowCanvas');
                svg.style.width = workspace.offsetWidth + 'px';
                svg.style.height = workspace.offsetHeight + 'px';
                drawArrows();
            }, 50);
        }

        function exportToCSV() {
            if (achievements.length === 0) {
                alert('–ù–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞!');
                return;
            }

            let csvContent = "ID,–¢–µ–∫—Å—Ç,–ü–æ–∑–∏—Ü–∏—è X,–ü–æ–∑–∏—Ü–∏—è Y,–í—ã–ø–æ–ª–Ω–µ–Ω–æ\n";
            
            achievements.forEach(ach => {
                const text = '"' + ach.text.replace(/"/g, '""') + '"';
                csvContent += `${ach.id},${text},${ach.x},${ach.y},${ach.completed}\n`;
            });

            csvContent += "\n\n–°–í–Ø–ó–ò\n–û—Ç ID,–ö ID\n";
            connections.forEach(conn => {
                csvContent += `${conn.from},${conn.to}\n`;
            });

            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', '–º–æ–∏_–¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è_' + new Date().toISOString().split('T')[0] + '.csv');
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            document.getElementById('infoText').textContent = '‚úÖ CSV —Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω! –û—Ç–∫—Ä–æ–π—Ç–µ –µ–≥–æ –≤ Google Sheets.';
            setTimeout(() => {
                document.getElementById('infoText').textContent = '–î–æ–±–∞–≤—å—Ç–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∏—Ö –º—ã—à–∫–æ–π. –ù–∞–∂–º–∏—Ç–µ "–°–æ–µ–¥–∏–Ω–∏—Ç—å", –≤—ã–±–µ—Ä–∏—Ç–µ –¥–≤–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–∏.';
            }, 5000);
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                const nextChar = line[i + 1];
                
                if (char === '"' && nextChar === '"') {
                    current += '"';
                    i++;
                } else if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result;
        }

        function importFromCSV(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const text = e.target.result;
                    const lines = text.split('\n');
                    
                    let newAchievements = [];
                    let newConnections = [];
                    let readingConnections = false;
                    let skipHeader = true;
                    
                    for (let i = 0; i < lines.length; i++) {
                        const line = lines[i].trim();
                        
                        if (line === '' || line === ',,,,') {
                            continue;
                        }
                        
                        if (line.includes('–°–í–Ø–ó–ò') || line === '–°–í–Ø–ó–ò,,,,') {
                            skipHeader = true;
                            continue;
                        }
                        
                        if (line.includes('–û—Ç ID') || line === '–û—Ç ID,–ö ID,,,') {
                            readingConnections = true;
                            continue;
                        }
                        
                        if (line.includes('ID,–¢–µ–∫—Å—Ç,–ü–æ–∑–∏—Ü–∏—è')) {
                            skipHeader = false;
                            continue;
                        }
                        
                        const parts = parseCSVLine(line);
                        
                        if (readingConnections) {
                            if (parts.length >= 2 && parts[0] && parts[1]) {
                                const fromId = parseInt(parts[0]);
                                const toId = parseInt(parts[1]);
                                if (!isNaN(fromId) && !isNaN(toId)) {
                                    newConnections.push({
                                        from: fromId,
                                        to: toId
                                    });
                                }
                            }
                        } else if (!skipHeader) {
                            if (parts.length >= 5 && parts[0]) {
                                const id = parseInt(parts[0]);
                                const text = parts[1];
                                const x = parseFloat(parts[2]);
                                const y = parseFloat(parts[3]);
                                const completed = parts[4].toLowerCase() === 'true';
                                
                                if (!isNaN(id) && text && !isNaN(x) && !isNaN(y)) {
                                    newAchievements.push({
                                        id: id,
                                        text: text,
                                        x: x,
                                        y: y,
                                        completed: completed
                                    });
                                }
                            }
                        }
                    }
                    
                    if (newAchievements.length > 0) {
                        if (confirm(`–ù–∞–π–¥–µ–Ω–æ ${newAchievements.length} –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∏ ${newConnections.length} —Å–≤—è–∑–µ–π. –ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ?`)) {
                            achievements = newAchievements;
                            connections = newConnections;
                            renderAchievements();
                            document.getElementById('infoText').textContent = `‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã! –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${newAchievements.length} –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∏ ${newConnections.length} —Å–≤—è–∑–µ–π.`;
                            setTimeout(() => {
                                document.getElementById('infoText').textContent = '–î–æ–±–∞–≤—å—Ç–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∏—Ö –º—ã—à–∫–æ–π. –ù–∞–∂–º–∏—Ç–µ "–°–æ–µ–¥–∏–Ω–∏—Ç—å", –≤—ã–±–µ—Ä–∏—Ç–µ –¥–≤–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–∏.';
                            }, 5000);
                        }
                    } else {
                        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç CSV.');
                    }
                    
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: ' + error.message);
                }
                
                event.target.value = '';
            };
            
            reader.readAsText(file);
        }

        function addAchievement() {
            const input = document.getElementById('achievementInput');
            const text = input.value.trim();
            
            if (!text) return;

            const achievement = {
                id: Date.now(),
                text: text,
                x: Math.random() * (window.innerWidth - 300) + 50,
                y: Math.random() * 400 + 100,
                completed: false
            };

            achievements.push(achievement);
            input.value = '';
            renderAchievements();
        }

        function toggleConnectMode() {
            connectMode = !connectMode;
            const btn = document.getElementById('connectBtn');
            const info = document.getElementById('infoText');
            
            if (connectMode) {
                btn.classList.add('active');
                btn.textContent = '‚ùå –û—Ç–º–µ–Ω–∏—Ç—å';
                info.textContent = '–†–µ–∂–∏–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: –≤—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ, –∑–∞—Ç–µ–º –≤—Ç–æ—Ä–æ–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–∏.';
                firstSelected = null;
            } else {
                btn.classList.remove('active');
                btn.textContent = 'üîó –°–æ–µ–¥–∏–Ω–∏—Ç—å';
                info.textContent = '–î–æ–±–∞–≤—å—Ç–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∏—Ö –º—ã—à–∫–æ–π. –ù–∞–∂–º–∏—Ç–µ "–°–æ–µ–¥–∏–Ω–∏—Ç—å", –≤—ã–±–µ—Ä–∏—Ç–µ –¥–≤–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–∏.';
                firstSelected = null;
            }
        }

        function toggleComplete(id) {
            const achievement = achievements.find(a => a.id === id);
            if (achievement) {
                achievement.completed = !achievement.completed;
                renderAchievements();
            }
        }

        function deleteAchievement(id) {
            achievements = achievements.filter(a => a.id !== id);
            connections = connections.filter(c => c.from !== id && c.to !== id);
            renderAchievements();
        }

        function selectForConnection(id) {
            if (!connectMode) return;

            if (!firstSelected) {
                firstSelected = id;
                document.getElementById('infoText').textContent = `–í—ã–±—Ä–∞–Ω–æ –ø–µ—Ä–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ. –¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Ç–æ—Ä–æ–µ –¥–ª—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.`;
            } else if (firstSelected === id) {
                document.getElementById('infoText').textContent = '–ù–µ–ª—å–∑—è —Å–æ–µ–¥–∏–Ω–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Å —Å–∞–º–∏–º —Å–æ–±–æ–π. –í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–µ.';
            } else {
                connections.push({ from: firstSelected, to: id });
                toggleConnectMode();
                renderAchievements();
            }
        }

        function renderAchievements() {
            const workspace = document.getElementById('workspace');
            const existingAchievements = workspace.querySelectorAll('.achievement');
            existingAchievements.forEach(el => el.remove());

            achievements.forEach(achievement => {
                const div = document.createElement('div');
                div.className = `achievement ${achievement.completed ? 'completed' : ''}`;
                div.style.left = achievement.x + 'px';
                div.style.top = achievement.y + 'px';
                div.dataset.id = achievement.id;

                div.innerHTML = `
                    <div class="achievement-text">${achievement.text}</div>
                    <div class="achievement-buttons">
                        <button class="btn-complete" onclick="toggleComplete(${achievement.id})">
                            ${achievement.completed ? '‚Ü©Ô∏è' : '‚úì'}
                        </button>
                        <button class="btn-delete" onclick="deleteAchievement(${achievement.id})">üóëÔ∏è</button>
                    </div>
                `;

                div.addEventListener('mousedown', startDrag);
                div.addEventListener('click', (e) => {
                    if (!e.target.closest('button')) {
                        selectForConnection(achievement.id);
                    }
                });

                workspace.appendChild(div);
            });

            drawArrows();
        }

        function startDrag(e) {
            if (e.target.closest('button')) return;
            
            draggedElement = e.currentTarget;
            const rect = draggedElement.getBoundingClientRect();
            const workspaceRect = document.getElementById('workspace').getBoundingClientRect();
            
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;

            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
        }

        function drag(e) {
            if (!draggedElement) return;

            const workspaceRect = document.getElementById('workspace').getBoundingClientRect();
            let newX = e.clientX - workspaceRect.left - offsetX;
            let newY = e.clientY - workspaceRect.top - offsetY;

            newX = Math.max(0, Math.min(newX, workspaceRect.width - draggedElement.offsetWidth));
            newY = Math.max(0, Math.min(newY, workspaceRect.height - draggedElement.offsetHeight));

            draggedElement.style.left = newX + 'px';
            draggedElement.style.top = newY + 'px';

            const id = parseInt(draggedElement.dataset.id);
            const achievement = achievements.find(a => a.id === id);
            if (achievement) {
                achievement.x = newX;
                achievement.y = newY;
            }

            drawArrows();
        }

        function stopDrag() {
            draggedElement = null;
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', stopDrag);
        }

        function drawArrows() {
            const svg = document.getElementById('arrowCanvas');
            svg.querySelectorAll('.arrow').forEach(el => el.remove());

            connections.forEach(conn => {
                const fromAch = achievements.find(a => a.id === conn.from);
                const toAch = achievements.find(a => a.id === conn.to);

                if (!fromAch || !toAch) return;

                const fromEl = document.querySelector(`[data-id="${conn.from}"]`);
                const toEl = document.querySelector(`[data-id="${conn.to}"]`);

                if (!fromEl || !toEl) return;

                const fromRect = fromEl.getBoundingClientRect();
                const toRect = toEl.getBoundingClientRect();
                const workspaceRect = document.getElementById('workspace').getBoundingClientRect();

                const x1 = fromRect.left + fromRect.width / 2 - workspaceRect.left;
                const y1 = fromRect.top + fromRect.height / 2 - workspaceRect.top;
                const x2 = toRect.left + toRect.width / 2 - workspaceRect.left;
                const y2 = toRect.top + toRect.height / 2 - workspaceRect.top;

                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                const dx = x2 - x1;
                const dy = y2 - y1;
                const curve = Math.abs(dx) * 0.3;

                const d = `M ${x1} ${y1} C ${x1 + curve} ${y1}, ${x2 - curve} ${y2}, ${x2} ${y2}`;
                path.setAttribute('d', d);
                path.setAttribute('class', `arrow ${fromAch.completed ? 'from-completed' : ''}`);
                path.setAttribute('marker-end', fromAch.completed ? 'url(#arrowhead-completed)' : 'url(#arrowhead)');

                svg.appendChild(path);
            });
        }

        document.getElementById('achievementInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addAchievement();
        });

        window.addEventListener('resize', () => {
            drawArrows();
        });

        updateWorkspaceSize();
    </script>
</body>
</html>
